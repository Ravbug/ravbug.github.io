<head>
    <title>WebPhoto</title>
    <meta name="description" content="Non-destructive image editing using CSS filters">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <link id="favicon" rel="icon" href="https://avatars2.githubusercontent.com/u/22283943" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="../bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../stylesheet.css">
</head>

<style>
    .view{
        display:grid;
        grid-template-columns: 1fr 240px;
        width: 100%;
        height: 100%;
    }
    .controls{
        background-color:#CCC;
        padding:5px;
        overflow:scroll;
    }
    #image{
        width:100%;
    }
    #render{
        overflow:scroll;
        background-color:#ababab
    }
    #image{
        object-fit:contain;
        max-height: 500px;
        vertical-align:middle;
    }
    .center {
        margin: 0;
        position: relative;
        top: 50%;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }
</style>

<div class=view>
    <div id="render">
        <img id=image class="center" src="https://wallpapercave.com/wp/YHSuCPt.jpg">
    </div>
    <div class=controls id="controlframe">
        <b>Image URL:</b><input id="img-url"><button onclick="loadurl()">Load</button>
        <hr>
    </div>
</div>

<script>
    //describes properties about the filters
    const filters = {
        "contrast":{unit: "%", min: 0, max: 200, val: 100},  
        "blur":{unit: "px", min: 0, max: 10, val: 0, step:0.1}, 
        "brightness":{unit: "", min: 0.0, max: 2.0, val: 1, step:0.01},
        "grayscale":{unit: "%", min: 0, max: 100, val: 0},
        "hue-rotate":{unit: "deg", min: 0, max: 360, val: 0},
        "invert":{unit: "%", min: 0, max: 100, val: 0},
        "saturate":{unit: "%", min: 0, max: 200, val: 100},
        "sepia":{unit: "%", min: 0, max: 100, val: 0}
    }

    let renderview = document.getElementById("image")

    let order = ["contrast","blur","brightness","grayscale","hue-rotate","invert","saturate","sepia"];

    /**
    Creates the filter render queue
    */
    function render(element){
        //enable the slider that changed
        try{
            document.getElementById(element.srcElement.id+"_enable").checked=true;
        }
        catch(e){}
        let queue = [];
        for (let filter of order){
            if (document.getElementById(filter+"_enable").checked){
                let val = document.getElementById(filter).value
                //add the function, value, and unit to the queue
                queue.push(`${filter}(${val}${filters[filter]["unit"]})`);
            }   
        }
        //apply the queue
        renderview.style.filter = queue.join(' ');
    }

    /*
    Sets up the default sliders
    */
    {
        let controls = document.getElementById("controlframe")
        let html = [];
        for (let filter of order){
            let d = filters[filter];
            if (!d.step){
                d.step=1;
            }
            html.push(`
                <b>${filter}</b>
                <input type="checkbox" id="${filter}_enable">
                <input type=range min=${d.min} max=${d.max} value=${d.val} id="${filter}" step=${d.step}>
                <hr>
            `);
        }
        controls.innerHTML += html.join('');
        //attach events
        for (let filter of order){
            document.getElementById(filter).oninput = render;
            document.getElementById(filter+"_enable").oninput = render;
        }
    }

    function loadurl(){
        let url = document.getElementById("img-url").value;
        document.getElementById("image").src=url;
    }

    render()
</script>